generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Tenant {
  id                    Int                    @id @default(autoincrement())
  name                  String
  slug                  String                 @unique @default(cuid())
  domain                String                 @unique
  status                String                 @default("active")
  defaultLanguage       String                 @default("tr")
  availableLanguages    String[]               @default(["tr"])
  theme                 String?
  primaryColor          String?
  isActive              Boolean                @default(true)
  createdAt             DateTime               @default(now())
  updatedAt             DateTime               @updatedAt
  activeSessions        ActiveSession[]
  alertRules            AlertRule[]
  analyticsReports      AnalyticsReport[]
  backupSchedules       BackupSchedule[]
  bannerPositions       BannerPosition[]
  banners               Banner[]
  blogCategories        BlogCategory[]
  blogPosts             BlogPost[]
  configurationBackups  ConfigurationBackup[]
  contactInfo           ContactInfo?
  contactSubmissions    ContactSubmission[]
  contentAnalytics      ContentAnalytics[]
  conversionGoals       ConversionGoal[]
  dashboardWidgets      DashboardWidget[]
  databaseBackups       DatabaseBackup[]
  galleries             Gallery[]
  healthChecks          HealthCheck[]
  locationCategories    LocationCategory[]
  logEntries            LogEntry[]
  maintenanceWindows    MaintenanceWindow[]
  mapConfigurations     MapConfiguration[]
  media                 Media[]
  menuItems             MenuItem[]
  menus                 Menu[]
  monitoringEvents      MonitoringEvent[]
  notificationTemplates NotificationTemplate[]
  ogTemplates           OGTemplate[]
  pageSeo               PageSEO[]
  pages                 Page[]
  redirects             Redirect[]
  references            Reference[]
  restoreOperations     RestoreOperation[]
  seoIntegration        SEOIntegration?
  seoSetting            SEOSetting?
  services              Service[]
  siteSetting           SiteSetting?
  sitemapConfig         SitemapConfig?
  sliders               Slider[]
  socialMediaAnalytics  SocialMediaAnalytics[]
  socialMediaLinks      SocialMediaLink[]
  socialMediaShares     SocialMediaShare[]
  structuredData        StructuredData[]
  systemBackups         SystemBackup[]
  systemMetrics         SystemMetric[]
  systemSettings        SystemSettings[]
  systemUpdates         SystemUpdate[]
  teamMembers           TeamMember[]
  tenantDomains         TenantDomain[]
  features              TenantFeature[]
  testimonials          Testimonial[]
  users                 User[]
  websiteAnalytics      WebsiteAnalytics[]

  @@map("tenants")
}

model User {
  id        Int        @id @default(autoincrement())
  tenantId  Int?
  role      Role
  name      String?
  email     String     @unique
  password  String
  isActive  Boolean    @default(true)
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  blogPosts BlogPost[] @relation("PostAuthor")
  media     Media[]    @relation("MediaUploader")
  tenant    Tenant?    @relation(fields: [tenantId], references: [id])

  @@map("users")
}

model TenantFeature {
  tenantId Int
  module   ModuleName
  enabled  Boolean    @default(true)
  tenant   Tenant     @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@id([tenantId, module])
  @@map("tenant_features")
}

model Page {
  id           Int               @id @default(autoincrement())
  tenantId     Int
  status       String?           @default("draft")
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @updatedAt
  menuItems    MenuItem[]
  translations PageTranslation[]
  tenant       Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  // Performance indexes for common queries
  @@index([tenantId, status]) // Status filtering per tenant
  @@index([tenantId, createdAt]) // Date sorting per tenant
  @@index([tenantId, updatedAt]) // Most common sort (default)
  @@map("pages")
}

model PageTranslation {
  id              Int     @id @default(autoincrement())
  pageId          Int
  language        String
  title           String
  slug            String
  contentJson     Json?
  metaTitle       String?
  metaDescription String?
  page            Page    @relation(fields: [pageId], references: [id], onDelete: Cascade)

  // Existing constraint
  @@unique([pageId, language])
  // Performance indexes for slug lookups and language filtering
  @@index([language, slug]) // Public page lookups by language+slug
  @@index([pageId, language]) // Translation loading per page
  @@index([slug]) // General slug searches
  @@map("page_translations")
}

model BlogCategory {
  id           Int                       @id @default(autoincrement())
  tenantId     Int
  parentId     Int?
  parent       BlogCategory?             @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children     BlogCategory[]            @relation("CategoryHierarchy")
  tenant       Tenant                    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  translations BlogCategoryTranslation[]
  blogPosts    BlogPost[]

  @@map("blog_categories")
}

model BlogCategoryTranslation {
  id         Int          @id @default(autoincrement())
  categoryId Int
  language   String
  name       String
  slug       String?
  category   BlogCategory @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  @@unique([categoryId, language])
  @@map("blog_category_translations")
}

model BlogPost {
  id           Int                   @id @default(autoincrement())
  tenantId     Int
  categoryId   Int?
  authorId     Int?
  isPublished  Boolean               @default(false)
  publishedAt  DateTime?
  createdAt    DateTime              @default(now())
  updatedAt    DateTime              @updatedAt
  translations BlogPostTranslation[]
  author       User?                 @relation("PostAuthor", fields: [authorId], references: [id])
  category     BlogCategory?         @relation(fields: [categoryId], references: [id])
  tenant       Tenant                @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@map("blog_posts")
}

model BlogPostTranslation {
  id              Int      @id @default(autoincrement())
  postId          Int
  language        String
  title           String
  slug            String
  summary         String?
  contentJson     Json?
  metaTitle       String?
  metaDescription String?
  post            BlogPost @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@unique([postId, language])
  @@map("blog_post_translations")
}

model Menu {
  id        Int        @id @default(autoincrement())
  tenantId  Int
  key       String
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  items     MenuItem[]
  tenant    Tenant     @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, key])
  @@map("menus")
}

model MenuItem {
  id           Int                   @id @default(autoincrement())
  tenantId     Int
  menuId       Int
  parentId     Int?
  order        Int?
  pageId       Int?
  externalUrl  String?
  translations MenuItemTranslation[]
  menu         Menu                  @relation(fields: [menuId], references: [id], onDelete: Cascade)
  page         Page?                 @relation(fields: [pageId], references: [id])
  parent       MenuItem?             @relation("MenuItemHierarchy", fields: [parentId], references: [id])
  children     MenuItem[]            @relation("MenuItemHierarchy")
  tenant       Tenant                @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@map("menu_items")
}

model MenuItemTranslation {
  id         Int      @id @default(autoincrement())
  menuItemId Int
  language   String
  label      String
  menuItem   MenuItem @relation(fields: [menuItemId], references: [id], onDelete: Cascade)

  @@unique([menuItemId, language])
  @@map("menu_item_translations")
}

model Media {
  id           Int      @id @default(autoincrement())
  tenantId     Int
  publicId     String
  url          String
  fileName     String?
  format       String?
  size         Int?
  uploadedAt   DateTime @default(now())
  uploadedById Int?
  tenant       Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  uploadedBy   User?    @relation("MediaUploader", fields: [uploadedById], references: [id])

  @@map("media")
}

model SiteSetting {
  id           Int                      @id @default(autoincrement())
  tenantId     Int                      @unique
  translations SiteSettingTranslation[]
  tenant       Tenant                   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@map("site_settings")
}

model SiteSettingTranslation {
  id                 Int         @id @default(autoincrement())
  siteSettingId      Int
  language           String
  siteName           String
  siteDescription    String?
  seoMetaTitle       String?
  seoMetaDescription String?
  siteSetting        SiteSetting @relation(fields: [siteSettingId], references: [id], onDelete: Cascade)

  @@unique([siteSettingId, language])
  @@map("site_setting_translations")
}

model Service {
  id           Int                  @id @default(autoincrement())
  tenantId     Int
  iconUrl      String?
  order        Int?
  isActive     Boolean              @default(true)
  isFeatured   Boolean              @default(false)
  createdAt    DateTime             @default(now())
  updatedAt    DateTime             @updatedAt
  translations ServiceTranslation[]
  tenant       Tenant               @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@map("services")
}

model ServiceTranslation {
  id               Int     @id @default(autoincrement())
  serviceId        Int
  language         String
  title            String
  slug             String
  shortDescription String?
  contentJson      Json?
  metaTitle        String?
  metaDescription  String?
  service          Service @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  @@unique([serviceId, language])
  @@map("service_translations")
}

model TeamMember {
  id           Int                     @id @default(autoincrement())
  tenantId     Int
  email        String?
  phone        String?
  imageUrl     String?
  order        Int?
  isActive     Boolean                 @default(true)
  createdAt    DateTime                @default(now())
  updatedAt    DateTime                @updatedAt
  socialLinks  SocialMediaLink[]
  translations TeamMemberTranslation[]
  tenant       Tenant                  @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@map("team_members")
}

model TeamMemberTranslation {
  id         Int        @id @default(autoincrement())
  teamId     Int
  language   String
  name       String
  position   String
  bio        String?
  expertise  String?
  teamMember TeamMember @relation(fields: [teamId], references: [id], onDelete: Cascade)

  @@unique([teamId, language])
  @@map("team_member_translations")
}

model Reference {
  id           Int                    @id @default(autoincrement())
  tenantId     Int
  imageUrl     String?
  projectUrl   String?
  clientName   String?
  projectDate  DateTime?
  category     String?
  order        Int?
  isActive     Boolean                @default(true)
  isFeatured   Boolean                @default(false)
  createdAt    DateTime               @default(now())
  updatedAt    DateTime               @updatedAt
  gallery      ReferenceGallery[]
  translations ReferenceTranslation[]
  tenant       Tenant                 @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@map("references")
}

model ReferenceTranslation {
  id              Int       @id @default(autoincrement())
  referenceId     Int
  language        String
  title           String
  slug            String
  description     String?
  contentJson     Json?
  metaTitle       String?
  metaDescription String?
  reference       Reference @relation(fields: [referenceId], references: [id], onDelete: Cascade)

  @@unique([referenceId, language])
  @@map("reference_translations")
}

model ReferenceGallery {
  id          Int       @id @default(autoincrement())
  referenceId Int
  imageUrl    String
  caption     String?
  order       Int?
  reference   Reference @relation(fields: [referenceId], references: [id], onDelete: Cascade)

  @@map("reference_gallery")
}

model ContactInfo {
  id           Int                      @id @default(autoincrement())
  tenantId     Int                      @unique
  logo         String?
  favicon      String?
  createdAt    DateTime                 @default(now())
  updatedAt    DateTime                 @updatedAt
  tenant       Tenant                   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  translations ContactInfoTranslation[]
  offices      Office[]
  socialLinks  SocialMediaLink[]

  @@map("contact_info")
}

model ContactInfoTranslation {
  id            Int         @id @default(autoincrement())
  contactInfoId Int
  language      String
  companyName   String
  tagline       String?
  description   String?
  workingHours  String?
  contactInfo   ContactInfo @relation(fields: [contactInfoId], references: [id], onDelete: Cascade)

  @@unique([contactInfoId, language])
  @@map("contact_info_translations")
}

model Office {
  id                  Int                  @id @default(autoincrement())
  contactInfoId       Int
  name                String
  email               String?
  phone               String?
  fax                 String?
  address             String?
  mapUrl              String?
  latitude            Float?
  longitude           Float?
  isPrimary           Boolean              @default(false)
  isActive            Boolean              @default(true)
  order               Int?
  locationAssignments LocationAssignment[]
  contactInfo         ContactInfo          @relation(fields: [contactInfoId], references: [id], onDelete: Cascade)

  @@map("offices")
}

model SocialMediaLink {
  id            Int                    @id @default(autoincrement())
  tenantId      Int
  platform      String
  url           String
  icon          String?
  isActive      Boolean                @default(true)
  order         Int?
  contactInfoId Int?
  teamMemberId  Int?
  analytics     SocialMediaAnalytics[]
  contactInfo   ContactInfo?           @relation(fields: [contactInfoId], references: [id], onDelete: Cascade)
  teamMember    TeamMember?            @relation(fields: [teamMemberId], references: [id], onDelete: Cascade)
  tenant        Tenant                 @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@map("social_media_links")
}

model Banner {
  id             Int                        @id @default(autoincrement())
  tenantId       Int
  type           String                     @default("slider")
  imageUrl       String
  mobileImageUrl String?
  linkUrl        String?
  order          Int?
  isActive       Boolean                    @default(true)
  startDate      DateTime?
  endDate        DateTime?
  createdAt      DateTime                   @default(now())
  updatedAt      DateTime                   @updatedAt
  positions      BannerPositionAssignment[]
  translations   BannerTranslation[]
  tenant         Tenant                     @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@map("banners")
}

model BannerTranslation {
  id         Int     @id @default(autoincrement())
  bannerId   Int
  language   String
  title      String?
  subtitle   String?
  buttonText String?
  altText    String?
  banner     Banner  @relation(fields: [bannerId], references: [id], onDelete: Cascade)

  @@unique([bannerId, language])
  @@map("banner_translations")
}

model Testimonial {
  id           Int                      @id @default(autoincrement())
  tenantId     Int
  clientName   String
  clientTitle  String?
  clientImage  String?
  rating       Int?
  isActive     Boolean                  @default(true)
  isFeatured   Boolean                  @default(false)
  order        Int?
  createdAt    DateTime                 @default(now())
  updatedAt    DateTime                 @updatedAt
  translations TestimonialTranslation[]
  tenant       Tenant                   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@map("testimonials")
}

model TestimonialTranslation {
  id            Int         @id @default(autoincrement())
  testimonialId Int
  language      String
  content       String
  projectName   String?
  testimonial   Testimonial @relation(fields: [testimonialId], references: [id], onDelete: Cascade)

  @@unique([testimonialId, language])
  @@map("testimonial_translations")
}

model Slider {
  id             Int                 @id @default(autoincrement())
  tenantId       Int
  key            String
  type           String              @default("carousel")
  autoPlay       Boolean             @default(true)
  autoPlaySpeed  Int                 @default(5000)
  showDots       Boolean             @default(true)
  showArrows     Boolean             @default(true)
  infinite       Boolean             @default(true)
  slidesToShow   Int                 @default(1)
  slidesToScroll Int                 @default(1)
  responsive     Json?
  isActive       Boolean             @default(true)
  order          Int?
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt
  items          SliderItem[]
  translations   SliderTranslation[]
  tenant         Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, key])
  @@map("sliders")
}

model SliderTranslation {
  id          Int     @id @default(autoincrement())
  sliderId    Int
  language    String
  title       String?
  description String?
  slider      Slider  @relation(fields: [sliderId], references: [id], onDelete: Cascade)

  @@unique([sliderId, language])
  @@map("slider_translations")
}

model SliderItem {
  id             Int                     @id @default(autoincrement())
  sliderId       Int
  imageUrl       String
  mobileImageUrl String?
  tabletImageUrl String?
  videoUrl       String?
  linkUrl        String?
  linkTarget     String                  @default("_self")
  overlayColor   String?
  overlayOpacity Float                   @default(0.0)
  textPosition   String                  @default("center")
  animationIn    String                  @default("fadeIn")
  animationOut   String                  @default("fadeOut")
  order          Int?
  isActive       Boolean                 @default(true)
  startDate      DateTime?
  endDate        DateTime?
  clickCount     Int                     @default(0)
  viewCount      Int                     @default(0)
  createdAt      DateTime                @default(now())
  updatedAt      DateTime                @updatedAt
  translations   SliderItemTranslation[]
  slider         Slider                  @relation(fields: [sliderId], references: [id], onDelete: Cascade)

  @@map("slider_items")
}

model SliderItemTranslation {
  id           Int        @id @default(autoincrement())
  sliderItemId Int
  language     String
  title        String?
  subtitle     String?
  content      String?
  buttonText   String?
  buttonColor  String?
  altText      String?
  sliderItem   SliderItem @relation(fields: [sliderItemId], references: [id], onDelete: Cascade)

  @@unique([sliderItemId, language])
  @@map("slider_item_translations")
}

model BannerPosition {
  id          Int                        @id @default(autoincrement())
  tenantId    Int
  key         String
  name        String
  width       Int?
  height      Int?
  maxBanners  Int                        @default(1)
  autoRotate  Boolean                    @default(false)
  rotateSpeed Int                        @default(10000)
  isActive    Boolean                    @default(true)
  createdAt   DateTime                   @default(now())
  updatedAt   DateTime                   @updatedAt
  banners     BannerPositionAssignment[]
  tenant      Tenant                     @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, key])
  @@map("banner_positions")
}

model BannerPositionAssignment {
  id              Int            @id @default(autoincrement())
  bannerId        Int
  positionId      Int
  order           Int            @default(0)
  weight          Int            @default(100)
  isActive        Boolean        @default(true)
  startDate       DateTime?
  endDate         DateTime?
  clickCount      Int            @default(0)
  viewCount       Int            @default(0)
  conversionCount Int            @default(0)
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  banner          Banner         @relation(fields: [bannerId], references: [id], onDelete: Cascade)
  position        BannerPosition @relation(fields: [positionId], references: [id], onDelete: Cascade)

  @@unique([bannerId, positionId])
  @@map("banner_position_assignments")
}

model SEOSetting {
  id            Int                     @id @default(autoincrement())
  tenantId      Int                     @unique
  robotsTxt     String?
  sitemap       Boolean                 @default(true)
  analyticsCode String?
  gtagCode      String?
  facebookPixel String?
  createdAt     DateTime                @default(now())
  updatedAt     DateTime                @updatedAt
  translations  SEOSettingTranslation[]
  tenant        Tenant                  @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@map("seo_settings")
}

model SEOSettingTranslation {
  id            Int        @id @default(autoincrement())
  seoSettingId  Int
  language      String
  metaKeywords  String?
  metaAuthor    String?
  metaCopyright String?
  ogTitle       String?
  ogDescription String?
  ogImage       String?
  seoSetting    SEOSetting @relation(fields: [seoSettingId], references: [id], onDelete: Cascade)

  @@unique([seoSettingId, language])
  @@map("seo_setting_translations")
}

model StructuredData {
  id         Int      @id @default(autoincrement())
  tenantId   Int
  entityType String
  entityId   String
  schemaType String
  jsonLd     Json
  isActive   Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  tenant     Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, entityType, entityId])
  @@map("structured_data")
}

model PageSEO {
  id           Int                  @id @default(autoincrement())
  tenantId     Int
  entityType   String
  entityId     Int
  canonicalUrl String?
  noIndex      Boolean              @default(false)
  noFollow     Boolean              @default(false)
  priority     Float?
  changeFreq   String?
  customRobots String?
  createdAt    DateTime             @default(now())
  updatedAt    DateTime             @updatedAt
  tenant       Tenant               @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  translations PageSEOTranslation[]

  @@unique([tenantId, entityType, entityId])
  @@map("page_seo")
}

model PageSEOTranslation {
  id                 Int     @id @default(autoincrement())
  pageSeoId          Int
  language           String
  metaTitle          String?
  metaDescription    String?
  metaKeywords       String?
  ogTitle            String?
  ogDescription      String?
  ogImage            String?
  ogType             String? @default("website")
  twitterCard        String? @default("summary_large_image")
  twitterTitle       String?
  twitterDescription String?
  twitterImage       String?
  pageSeo            PageSEO @relation(fields: [pageSeoId], references: [id], onDelete: Cascade)

  @@unique([pageSeoId, language])
  @@map("page_seo_translations")
}

model Redirect {
  id          Int       @id @default(autoincrement())
  tenantId    Int
  fromUrl     String
  toUrl       String
  statusCode  Int       @default(301)
  isActive    Boolean   @default(true)
  hitCount    Int       @default(0)
  lastHit     DateTime?
  description String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  tenant      Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, fromUrl])
  @@map("redirects")
}

model SitemapConfig {
  id                Int       @id @default(autoincrement())
  tenantId          Int       @unique
  includePages      Boolean   @default(true)
  includeBlog       Boolean   @default(true)
  includeServices   Boolean   @default(true)
  includeTeam       Boolean   @default(false)
  includeReferences Boolean   @default(true)
  includeGalleries  Boolean   @default(false)
  maxUrls           Int       @default(50000)
  autoSubmit        Boolean   @default(false)
  lastGenerated     DateTime?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  tenant            Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@map("sitemap_config")
}

model SEOIntegration {
  id                  Int      @id @default(autoincrement())
  tenantId            Int      @unique
  googleAnalyticsId   String?
  googleTagManagerId  String?
  googleSearchConsole String?
  bingWebmasterTools  String?
  facebookDomainVerif String?
  pinterestVerif      String?
  yandexVerif         String?
  customHeadScripts   String?
  customBodyScripts   String?
  isActive            Boolean  @default(true)
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  tenant              Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@map("seo_integrations")
}

model OGTemplate {
  id           Int                     @id @default(autoincrement())
  tenantId     Int
  name         String
  entityType   String
  isDefault    Boolean                 @default(false)
  imageUrl     String?
  imageWidth   Int?                    @default(1200)
  imageHeight  Int?                    @default(630)
  createdAt    DateTime                @default(now())
  updatedAt    DateTime                @updatedAt
  translations OGTemplateTranslation[]
  tenant       Tenant                  @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, name])
  @@map("og_templates")
}

model OGTemplateTranslation {
  id            Int        @id @default(autoincrement())
  templateId    Int
  language      String
  titleTemplate String?
  descTemplate  String?
  template      OGTemplate @relation(fields: [templateId], references: [id], onDelete: Cascade)

  @@unique([templateId, language])
  @@map("og_template_translations")
}

model Gallery {
  id           Int                  @id @default(autoincrement())
  tenantId     Int
  coverImage   String?
  type         String               @default("general")
  isActive     Boolean              @default(true)
  order        Int?
  createdAt    DateTime             @default(now())
  updatedAt    DateTime             @updatedAt
  tenant       Tenant               @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  images       GalleryImage[]
  translations GalleryTranslation[]

  @@map("galleries")
}

model GalleryTranslation {
  id          Int     @id @default(autoincrement())
  galleryId   Int
  language    String
  name        String
  slug        String
  description String?
  gallery     Gallery @relation(fields: [galleryId], references: [id], onDelete: Cascade)

  @@unique([galleryId, language])
  @@map("gallery_translations")
}

model GalleryImage {
  id        Int     @id @default(autoincrement())
  galleryId Int
  imageUrl  String
  caption   String?
  order     Int?
  gallery   Gallery @relation(fields: [galleryId], references: [id], onDelete: Cascade)

  @@map("gallery_images")
}

model ContactSubmission {
  id        Int      @id @default(autoincrement())
  tenantId  Int
  name      String
  email     String
  phone     String?
  subject   String?
  message   String
  isRead    Boolean  @default(false)
  isReplied Boolean  @default(false)
  ipAddress String?
  userAgent String?
  createdAt DateTime @default(now())
  tenant    Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@map("contact_submissions")
}

model SocialMediaAnalytics {
  id           Int              @id @default(autoincrement())
  tenantId     Int
  socialLinkId Int?
  platform     String
  metricType   String
  metricValue  Int              @default(0)
  referrer     String?
  ipAddress    String?
  userAgent    String?
  date         DateTime         @default(now())
  socialLink   SocialMediaLink? @relation(fields: [socialLinkId], references: [id], onDelete: Cascade)
  tenant       Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, platform, date])
  @@map("social_media_analytics")
}

model MapConfiguration {
  id                  Int                  @id @default(autoincrement())
  tenantId            Int
  name                String
  mapType             String               @default("google")
  provider            String               @default("google")
  apiKey              String?
  style               String?
  defaultZoom         Int                  @default(15)
  showMarkers         Boolean              @default(true)
  showInfoWindows     Boolean              @default(true)
  enableDirections    Boolean              @default(true)
  enableStreetView    Boolean              @default(true)
  markerColor         String?              @default("#FF0000")
  markerIcon          String?
  width               String?              @default("100%")
  height              String?              @default("400px")
  isActive            Boolean              @default(true)
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  locationAssignments LocationAssignment[]
  tenant              Tenant               @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@map("map_configurations")
}

model LocationCategory {
  id                  Int                           @id @default(autoincrement())
  tenantId            Int
  name                String
  icon                String?
  color               String?
  description         String?
  isActive            Boolean                       @default(true)
  order               Int?
  createdAt           DateTime                      @default(now())
  updatedAt           DateTime                      @updatedAt
  locationAssignments LocationAssignment[]
  tenant              Tenant                        @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  translations        LocationCategoryTranslation[]

  @@map("location_categories")
}

model LocationCategoryTranslation {
  id                 Int              @id @default(autoincrement())
  locationCategoryId Int
  language           String
  name               String
  description        String?
  locationCategory   LocationCategory @relation(fields: [locationCategoryId], references: [id], onDelete: Cascade)

  @@unique([locationCategoryId, language])
  @@map("location_category_translations")
}

model LocationAssignment {
  id                 Int               @id @default(autoincrement())
  officeId           Int
  mapConfigurationId Int?
  locationCategoryId Int?
  customMarkerIcon   String?
  customMarkerColor  String?
  showInWidget       Boolean           @default(true)
  order              Int?
  createdAt          DateTime          @default(now())
  locationCategory   LocationCategory? @relation(fields: [locationCategoryId], references: [id], onDelete: Cascade)
  mapConfiguration   MapConfiguration? @relation(fields: [mapConfigurationId], references: [id], onDelete: Cascade)
  office             Office            @relation(fields: [officeId], references: [id], onDelete: Cascade)

  @@unique([officeId, mapConfigurationId])
  @@map("location_assignments")
}

model SocialMediaShare {
  id         Int      @id @default(autoincrement())
  tenantId   Int
  entityType String
  entityId   Int
  platform   String
  url        String
  title      String?
  ipAddress  String?
  userAgent  String?
  referrer   String?
  sharedAt   DateTime @default(now())
  tenant     Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, entityType, entityId])
  @@index([tenantId, platform, sharedAt])
  @@map("social_media_shares")
}

model WebsiteAnalytics {
  id          Int      @id @default(autoincrement())
  tenantId    Int
  sessionId   String?
  userId      String?
  ipAddress   String?
  userAgent   String?
  deviceType  String?
  browserName String?
  osName      String?
  country     String?
  city        String?
  language    String?
  pageUrl     String
  pagePath    String
  pageTitle   String?
  referrer    String?
  entityType  String?
  entityId    Int?
  timeOnPage  Int?     @default(0)
  scrollDepth Int?     @default(0)
  bounceRate  Boolean  @default(false)
  exitPage    Boolean  @default(false)
  utmSource   String?
  utmMedium   String?
  utmCampaign String?
  utmTerm     String?
  utmContent  String?
  loadTime    Int?
  errors      String?
  visitedAt   DateTime @default(now())
  createdAt   DateTime @default(now())
  tenant      Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, visitedAt])
  @@index([tenantId, pageUrl])
  @@index([tenantId, sessionId])
  @@index([tenantId, entityType, entityId])
  @@map("website_analytics")
}

model DashboardWidget {
  id              Int      @id @default(autoincrement())
  tenantId        Int
  name            String
  type            String
  category        String
  dataSource      String
  query           Json?
  filters         Json?
  title           String?
  description     String?
  icon            String?
  color           String?
  size            String   @default("medium")
  position        Json?
  isPublic        Boolean  @default(false)
  allowedRoles    String[] @default([])
  refreshInterval Int?     @default(300)
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  tenant          Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, category])
  @@index([tenantId, isActive])
  @@map("dashboard_widgets")
}

model AnalyticsReport {
  id          Int               @id @default(autoincrement())
  tenantId    Int
  name        String
  description String?
  reportType  String
  metrics     Json
  dateRange   String
  startDate   DateTime?
  endDate     DateTime?
  filters     Json?
  format      String            @default("pdf")
  recipients  String[]
  isScheduled Boolean           @default(false)
  schedule    String?
  timezone    String            @default("UTC")
  nextRunAt   DateTime?
  lastRunAt   DateTime?
  isActive    Boolean           @default(true)
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  tenant      Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  executions  ReportExecution[]

  @@index([tenantId, isScheduled, nextRunAt])
  @@map("analytics_reports")
}

model ReportExecution {
  id            Int             @id @default(autoincrement())
  reportId      Int
  status        String
  startedAt     DateTime        @default(now())
  completedAt   DateTime?
  duration      Int?
  fileUrl       String?
  fileSize      Int?
  recordCount   Int?
  errorMessage  String?
  executionData Json?
  createdAt     DateTime        @default(now())
  report        AnalyticsReport @relation(fields: [reportId], references: [id], onDelete: Cascade)

  @@index([reportId, status])
  @@map("report_executions")
}

model SystemMetric {
  id                Int      @id @default(autoincrement())
  tenantId          Int?
  metricType        String
  metricName        String
  value             Float
  unit              String?
  category          String
  component         String?
  warningThreshold  Float?
  criticalThreshold Float?
  status            String   @default("normal")
  metadata          Json?
  tags              String[]
  recordedAt        DateTime @default(now())
  createdAt         DateTime @default(now())
  tenant            Tenant?  @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, metricType, recordedAt])
  @@index([tenantId, status])
  @@map("system_metrics")
}

model ContentAnalytics {
  id                Int      @id @default(autoincrement())
  tenantId          Int
  entityType        String
  entityId          Int
  contentTitle      String?
  contentSlug       String?
  viewCount         Int      @default(0)
  uniqueViews       Int      @default(0)
  averageTimeOnPage Int      @default(0)
  bounceRate        Float    @default(0)
  conversionRate    Float    @default(0)
  shareCount        Int      @default(0)
  commentCount      Int      @default(0)
  organicTraffic    Int      @default(0)
  searchImpressions Int      @default(0)
  searchClicks      Int      @default(0)
  averagePosition   Float    @default(0)
  date              DateTime
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  tenant            Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, entityType, entityId, date])
  @@index([tenantId, date])
  @@index([tenantId, entityType])
  @@map("content_analytics")
}

model ActiveSession {
  id           String   @id
  tenantId     Int
  ipAddress    String?
  userAgent    String?
  deviceType   String?
  country      String?
  city         String?
  currentPage  String
  pageTitle    String?
  lastActivity DateTime @default(now())
  startedAt    DateTime @default(now())
  pageViews    Int      @default(1)
  timeOnSite   Int      @default(0)
  referrer     String?
  isBot        Boolean  @default(false)
  expiresAt    DateTime
  tenant       Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, lastActivity])
  @@index([expiresAt])
  @@map("active_sessions")
}

model ConversionGoal {
  id            Int          @id @default(autoincrement())
  tenantId      Int
  name          String
  description   String?
  goalType      String
  targetUrl     String?
  targetElement String?
  eventName     String?
  conditions    Json?
  hasValue      Boolean      @default(false)
  defaultValue  Float?
  currency      String?      @default("USD")
  isActive      Boolean      @default(true)
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  tenant        Tenant       @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  conversions   Conversion[]

  @@index([tenantId, isActive])
  @@map("conversion_goals")
}

model Conversion {
  id          Int            @id @default(autoincrement())
  goalId      Int
  sessionId   String?
  ipAddress   String?
  userAgent   String?
  referrer    String?
  value       Float?
  currency    String?
  utmSource   String?
  utmMedium   String?
  utmCampaign String?
  metadata    Json?
  convertedAt DateTime       @default(now())
  createdAt   DateTime       @default(now())
  goal        ConversionGoal @relation(fields: [goalId], references: [id], onDelete: Cascade)

  @@index([goalId, convertedAt])
  @@map("conversions")
}

model SystemSettings {
  id             Int      @id @default(autoincrement())
  tenantId       Int?
  category       String
  name           String
  description    String?
  general        String?
  security       String?
  email          String?
  fileUpload     String?
  cache          String?
  database       String?
  logging        String?
  performance    String?
  features       String?
  customSettings String?
  isActive       Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  tenant         Tenant?  @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, category])
  @@index([tenantId, category])
  @@index([category, isActive])
  @@map("system_settings")
}

model ConfigurationBackup {
  id            String    @id @default(cuid())
  tenantId      Int?
  name          String
  description   String?
  settingsData  String
  settingsCount Int       @default(0)
  categories    String[]
  isAutomatic   Boolean   @default(false)
  isCompressed  Boolean   @default(true)
  fileSize      Int?
  checksum      String?
  createdAt     DateTime  @default(now())
  expiresAt     DateTime?
  tenant        Tenant?   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, createdAt])
  @@index([createdAt, expiresAt])
  @@map("configuration_backups")
}

model LogEntry {
  id         String   @id @default(cuid())
  tenantId   Int?
  level      String
  message    String
  context    String?
  metadata   String?
  sessionId  String?
  requestId  String?
  ipAddress  String?
  userAgent  String?
  userId     Int?
  duration   Int?
  statusCode Int?
  method     String?
  url        String?
  stack      String?
  error      String?
  tags       String[]
  timestamp  DateTime @default(now())
  createdAt  DateTime @default(now())
  tenant     Tenant?  @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, level, timestamp])
  @@index([tenantId, context])
  @@index([timestamp, level])
  @@index([sessionId])
  @@index([requestId])
  @@map("log_entries")
}

model AlertRule {
  id                   String   @id @default(cuid())
  tenantId             Int?
  name                 String
  description          String?
  metric               String
  condition            String
  threshold            Float
  severity             String
  enabled              Boolean  @default(true)
  duration             Int?
  cooldown             Int?
  notificationChannels String[]
  recipients           String[]
  labels               String?
  annotations          String?
  runbook              String?
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
  tenant               Tenant?  @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  alerts               Alert[]

  @@index([tenantId, enabled])
  @@index([metric, enabled])
  @@map("alert_rules")
}

model Alert {
  id                String    @id @default(cuid())
  ruleId            String
  status            String
  severity          String
  message           String
  description       String?
  triggeredAt       DateTime  @default(now())
  resolvedAt        DateTime?
  acknowledgedAt    DateTime?
  acknowledgedBy    String?
  tenantId          Int?
  metric            String
  actualValue       Float
  threshold         Float
  labels            String?
  annotations       String?
  lastNotifiedAt    DateTime?
  notificationCount Int       @default(0)
  fingerprint       String?
  generatorURL      String?
  rule              AlertRule @relation(fields: [ruleId], references: [id], onDelete: Cascade)

  @@index([ruleId, status])
  @@index([status, severity])
  @@index([triggeredAt])
  @@index([tenantId, status])
  @@map("alerts")
}

model NotificationTemplate {
  id        String   @id @default(cuid())
  tenantId  Int?
  name      String
  channel   String
  subject   String
  body      String
  variables String[]
  isDefault Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  tenant    Tenant?  @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, name, channel])
  @@index([channel, isDefault])
  @@map("notification_templates")
}

model MaintenanceWindow {
  id                   String   @id @default(cuid())
  tenantId             Int?
  name                 String
  description          String?
  startTime            DateTime
  endTime              DateTime
  services             String[]
  silenceAlerts        Boolean  @default(true)
  disableNotifications Boolean  @default(true)
  createdBy            Int?
  createdAt            DateTime @default(now())
  tenant               Tenant?  @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, startTime, endTime])
  @@index([startTime, endTime])
  @@map("maintenance_windows")
}

model HealthCheck {
  id             String              @id @default(cuid())
  tenantId       Int?
  name           String
  type           String              @default("http")
  url            String?
  expectedStatus Int?
  timeout        Int                 @default(5000)
  interval       Int                 @default(60)
  retries        Int                 @default(3)
  enabled        Boolean             @default(true)
  headers        String?
  customScript   String?
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt
  results        HealthCheckResult[]
  tenant         Tenant?             @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, enabled])
  @@index([type, enabled])
  @@map("health_checks")
}

model HealthCheckResult {
  id            String      @id @default(cuid())
  healthCheckId String
  status        String
  message       String?
  duration      Int?
  responseCode  Int?
  error         String?
  metadata      String?
  checkedAt     DateTime    @default(now())
  healthCheck   HealthCheck @relation(fields: [healthCheckId], references: [id], onDelete: Cascade)

  @@index([healthCheckId, checkedAt])
  @@index([status, checkedAt])
  @@map("health_check_results")
}

model MonitoringEvent {
  id        String   @id @default(cuid())
  tenantId  Int?
  type      String
  source    String
  action    String
  data      String?
  processed Boolean  @default(false)
  userId    Int?
  sessionId String?
  ipAddress String?
  timestamp DateTime @default(now())
  createdAt DateTime @default(now())
  tenant    Tenant?  @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, type, timestamp])
  @@index([type, processed])
  @@index([timestamp])
  @@map("monitoring_events")
}

model TenantDomain {
  id                Int       @id @default(autoincrement())
  tenantId          Int
  domain            String    @unique
  isPrimary         Boolean   @default(false)
  isActive          Boolean   @default(true)
  type              String    @default("custom")
  sslStatus         String?   @default("pending")
  sslIssuedAt       DateTime?
  sslExpiresAt      DateTime?
  isVerified        Boolean   @default(false)
  verificationToken String?
  verifiedAt        DateTime?
  lastCheckedAt     DateTime?
  responseTime      Int?
  status            String    @default("active")
  metadata          Json?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  tenant            Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, isPrimary])
  @@index([domain, isActive])
  @@index([type, isActive])
  @@map("tenant_domains")
}

model DatabaseBackup {
  id              String    @id @default(cuid())
  tenantId        Int?
  name            String
  description     String?
  backupType      String
  compressionType String    @default("gzip")
  filePath        String
  fileName        String
  fileSize        Int?
  checksum        String?
  status          String    @default("pending")
  progress        Int       @default(0)
  errorMessage    String?
  duration        Int?
  recordsCount    Int?
  tablesCount     Int?
  startedAt       DateTime?
  completedAt     DateTime?
  expiresAt       DateTime?
  isAutomatic     Boolean   @default(false)
  retentionDays   Int?      @default(30)
  metadata        Json?
  tags            String[]
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  tenant          Tenant?   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, status])
  @@index([status, createdAt])
  @@index([expiresAt])
  @@index([backupType, isAutomatic])
  @@map("database_backups")
}

model SystemBackup {
  id                String             @id @default(cuid())
  tenantId          Int?
  name              String
  description       String?
  backupType        String
  includeDatabase   Boolean            @default(true)
  includeFiles      Boolean            @default(true)
  includeConfig     Boolean            @default(true)
  includeMedia      Boolean            @default(true)
  includeLogs       Boolean            @default(false)
  archivePath       String?
  archiveSize       Int?
  compressionRatio  Float?
  checksum          String?
  status            String             @default("pending")
  progress          Int                @default(0)
  currentPhase      String?
  errorMessage      String?
  duration          Int?
  filesCount        Int?
  foldersCount      Int?
  originalSize      Int?
  startedAt         DateTime?
  completedAt       DateTime?
  expiresAt         DateTime?
  isAutomatic       Boolean            @default(false)
  retentionDays     Int?               @default(7)
  canRestore        Boolean            @default(true)
  restoreNotes      String?
  metadata          Json?
  tags              String[]
  version           String?
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  restoreOperations RestoreOperation[]
  tenant            Tenant?            @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, status])
  @@index([status, createdAt])
  @@index([expiresAt])
  @@index([backupType, isAutomatic])
  @@map("system_backups")
}

model BackupSchedule {
  id                  String    @id @default(cuid())
  tenantId            Int?
  name                String
  description         String?
  scheduleType        String
  backupType          String
  cronExpression      String
  timezone            String    @default("UTC")
  isEnabled           Boolean   @default(true)
  retentionDays       Int       @default(30)
  compressionType     String    @default("gzip")
  maxBackups          Int       @default(10)
  notifyOnSuccess     Boolean   @default(false)
  notifyOnFailure     Boolean   @default(true)
  recipients          String[]
  lastRunAt           DateTime?
  nextRunAt           DateTime?
  lastStatus          String?
  consecutiveFailures Int       @default(0)
  maxDuration         Int?
  maxSize             Int?
  metadata            Json?
  tags                String[]
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  tenant              Tenant?   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, isEnabled])
  @@index([isEnabled, nextRunAt])
  @@index([scheduleType, isEnabled])
  @@map("backup_schedules")
}

model RestoreOperation {
  id              String        @id @default(cuid())
  tenantId        Int?
  backupId        String?
  backupType      String
  restoreType     String
  targetLocation  String?
  restoreDatabase Boolean       @default(true)
  restoreFiles    Boolean       @default(true)
  restoreConfig   Boolean       @default(true)
  restoreMedia    Boolean       @default(true)
  status          String        @default("pending")
  progress        Int           @default(0)
  currentPhase    String?
  errorMessage    String?
  duration        Int?
  restoredFiles   Int?
  restoredSize    Int?
  startedAt       DateTime?
  completedAt     DateTime?
  initiatedBy     Int?
  reason          String?
  approvedBy      Int?
  canRollback     Boolean       @default(false)
  rollbackData    String?
  metadata        Json?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  systemBackup    SystemBackup? @relation(fields: [backupId], references: [id])
  tenant          Tenant?       @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, status])
  @@index([status, createdAt])
  @@index([backupId])
  @@map("restore_operations")
}

model SystemUpdate {
  id                String    @id @default(cuid())
  tenantId          Int?
  name              String
  description       String?
  updateType        String
  version           String
  currentVersion    String?
  packageUrl        String?
  packageSize       Int?
  packageChecksum   String?
  releaseNotes      String?
  requirements      Json?
  dependencies      Json?
  conflicts         Json?
  status            String    @default("pending")
  progress          Int       @default(0)
  currentPhase      String?
  errorMessage      String?
  preUpdateBackupId String?
  autoBackup        Boolean   @default(true)
  scheduledAt       DateTime?
  startedAt         DateTime?
  completedAt       DateTime?
  canRollback       Boolean   @default(true)
  rollbackData      String?
  rolledBackAt      DateTime?
  initiatedBy       Int?
  approvedBy        Int?
  testsPassed       Boolean?
  validationResults Json?
  notifyOnComplete  Boolean   @default(true)
  notifyOnFailure   Boolean   @default(true)
  recipients        String[]
  metadata          Json?
  tags              String[]
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  tenant            Tenant?   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, status])
  @@index([status, scheduledAt])
  @@index([updateType, status])
  @@index([version])
  @@map("system_updates")
}

enum Role {
  SUPER_ADMIN
  TENANT_ADMIN
  EDITOR
}

enum ModuleName {
  PAGES
  BLOG
  MENU
  MEDIA
  SETTINGS
}
